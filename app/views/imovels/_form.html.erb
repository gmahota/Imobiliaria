<script type="text/javascript">
  $(function(){
    
    $('#myTab a').click(function (e) {
      e.preventDefault();
      $(this).tab('show');
    })
    
    
    $("#imovel_tipoImovel").change( function() {
      $("#imovel_tipologia").empty();
      $('#imovel_tipologia').append('<option value="">' + "Tipologia" + '</option>');
      
    if( $("#imovel_tipoImovel").val() == "Apartamento") {
        $('#imovel_tipologia').append('<option value="T1">' + 'T1' + '</option>');
        $('#imovel_tipologia').append('<option value="T2">' + 'T2' + '</option>');
        $('#imovel_tipologia').append('<option value="T3">' + 'T3' + '</option>');
        $('#imovel_tipologia').append('<option value="T4">' + 'T4' + '</option>');
    }
    
    if( $("#imovel_tipoImovel").val() == "Vivenda") {
        $('#imovel_tipologia').append('<option value="V1">' + 'V1' + '</option>');
        $('#imovel_tipologia').append('<option value="V2">' + 'V2' + '</option>');
        $('#imovel_tipologia').append('<option value="V3">' + 'V3' + '</option>');
        $('#imovel_tipologia').append('<option value="V4">' + 'V4' + '</option>');
    }
    });
  });
</script>

<style>
	#map-canvas {
		width: 500px;
		height: 500px;
	}
</style>
  
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>

    <script>
function initialize() {
  
  var geocoder;
  
  var mapOptions = {
    zoom: 15,
    center: new google.maps.LatLng(-25.97097,32.582224),
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };
  var mapDiv = document.getElementById('map-canvas');
  var map = new google.maps.Map(mapDiv, mapOptions);

  // We add a DOM event here to show an alert if the DIV containing the
  // map is clicked. Note that we do this within the intialize function
  // since the document object isn't loaded until after the window.load
  // event.
  google.maps.event.addListener(map, 'click', function(event){
    
   //alert('Lat: ' + event.latLng.lat() + ' and Longitude is: ' + event.latLng.lng());
  $("#imovel_latitude").val(event.latLng.lat());
   $("#imovel_longitude").val(event.latLng.lng());
  
  
  
  
  var myLatlng = new google.maps.LatLng(event.latLng.lat(),event.latLng.lng());
  var marker = new google.maps.Marker({
      position: myLatlng,
      map: map,
      title: 'Hello World!'
  });
  
  // Add circle overlay and bind to marker
  var circle = new google.maps.Circle({
    map: map,
    radius:("#imovel_raio").val(),    // metres
    fillColor: '#AA0000'
  });
  circle.bindTo('center', marker, 'position');
  
  
}
);


}

google.maps.event.addDomListener(window, 'load', initialize);

    </script>



<%= simple_nested_form_for @imovel ,  :html => {:multipart => true} do |f| %>
  <%= f.error_notification %>
  
  <div class="form-inputs">
 
  <div class="container">
    <div class="span6">
    <ul class="nav nav-tabs" id="myTab">
      <li class="active"><a href="#dados">Dados Imovel</a></li>
      <li><a href="#localizacao">Localização</a></li>
      <li><a href="#dadoscom">Dados Comercias</a></li>
      <li><a href="#doc">Fotos/Documentos</a></li>
    </ul>
 
    <div class="tab-content">
      <div class="tab-pane active" id="dados">
        <%= f.input :referencia %>
        <%= f.input :resumo %>
        <%= f.input :descriacao , as: :text %>
      </div>
      <div class="tab-pane" id="localizacao">
        <%= select("imovel","cidade", Cidade.all.collect { |p| [p.descricao,p.descricao ]}, {include_blank: 'None'})%>
        
        <%= f.input :area %>
        <%= f.input :localizacao %>
        <%= f.input :latitude %>
        <%= f.input :longitude %>
        <%= f.input :raio %>
        
        
        
      </div>
      <div class="tab-pane" id="dadoscom">
        <p>Tipo de Negocio  
        <%= select("imovel","tipoNegocio", TipoNegocio.all.collect { |p| [p.descricao,p.descricao ]}, {include_blank: 'None'})%>
        </p>
        
        <p>Tipo de Imovel
        <%= select("imovel","tipoImovel", TipoImovel.all.collect { |p| [p.descricao,p.descricao ]}, {include_blank: 'None'})%>
        </p>
        
        <p>Tipologia
        <%= select("imovel","tipologia", Tipologium.all.collect { |p| [p.descricao,p.descricao ]}, {include_blank: 'None'})%>
        </p>
        
        <p>
        Estado
        <%= select("imovel","estado", Estado.all.collect { |p| [p.descricao,p.descricao ]}, {include_blank: 'None'})%>
        </p>
        
        <%= f.input :preco %>
        <p>
        Moeda
        <%= select("imovel","moeda", Moeda.all.collect { |p| [p.descricao,p.sigla ]}, {include_blank: 'None'})%>
        </p>
      </div>
      <div class="tab-pane" id="doc">
        <div>
          
        <%= f.fields_for :documentos  ,  :html => {:multipart => true} do |doc| %>
         
            <%= doc.select :descricao,Fotosresposta.all.collect { |p| [p.descricao,p.descricao ]}, {include_blank: 'None'}%>
            
            <%= doc.input :avatar, :as => :file %>
            
          
          <%= doc.link_to_remove "Apagar" ,class: "btn btn-small btn-danger" %>
        
        <% end %>
        
        
           
        
        <p><%= f.link_to_add "Adicionar Documentos", :documentos %></p>
        </div>
      </div>
    </div>

  <div class="form-actions">
    <%= f.button :submit %>
  </div>
  <div id="map-canvas"></div>
<% end %>
